<VirtualHost *:80>
    ServerName portainer.simax-dev.net

    # Proxy to Portainer
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:9000/
    ProxyPassReverse / http://127.0.0.1:9000/
    RequestHeader set X-Forwarded-Proto "https"

    ProxyVia Block

    <Proxy *>
        Require all granted
    </Proxy>

    # SSL Configuration - uses strong cipher list - these might need to be downgraded if you need to support older browsers/devices
    # SSLEngine on
    # SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH
    # SSLProtocol All -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    # SSLHonorCipherOrder On

    # HSTS (optional)
    Header always set Strict-Transport-Security "max-age=63072000; includeSubdomains;"
    # Prevent MIME based attacks
    Header set X-Content-Type-Options "nosniff"

    ErrorLog /var/log/apache2/portainer-error.log
    CustomLog /var/log/apache2/portainer-access.log combined

    #Proxy to docker container console

    <Location /api/websocket/>
        RewriteEngine on
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
        RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
        RewriteRule /api/websocket/(.*) ws://127.0.0.1:9000/api/websocket/$1 [P]
    </Location>
</VirtualHost>
